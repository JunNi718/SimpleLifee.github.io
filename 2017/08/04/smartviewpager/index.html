<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="google-site-verification" content="" />
  
  <title>可以知道滑动方向的 ViewPager</title>
  <meta name="author" content="SmartNi">
  <meta name="description" content="写出来是为了更好的理解">
  
  
  <meta property="og:title" content="可以知道滑动方向的 ViewPager"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:site_name" content="SmartNi"/>
  <link href="/apple-touch-icon-precomposed.png" sizes="180x180" rel="apple-touch-icon-precomposed">
  <link rel="alternate" href="/atom.xml" title="SmartNi" type="application/atom+xml">
  <link rel="stylesheet" href="//cdn.bootcss.com/bootstrap/3.3.6/css/bootstrap.min.css">
  <link rel="stylesheet" href="/css/m.min.css">
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
</head>

<body>
  <a id="top"></a>
  <div id="main">
    <div class="behind">
      <a href="/" class="back black-color">
        <svg class="i-close" viewBox="0 0 32 32" width="22" height="22" fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="3">
            <path d="M2 30 L30 2 M30 30 L2 2"></path>
        </svg>
      </a>
      <div class="description">
        &nbsp;专注
      </div>
    </div>
    <div class="main-ctnr">
      

  <article class="standard post">
    <div class="title">
      
  
    <h1 class="page-title center">
        可以知道滑动方向的 ViewPager
    </h1>
  


    </div>
    <div class="meta center">
      
<time datetime="2017-08-04T12:24:37.000Z">
<svg class="i-calendar" viewBox="0 0 32 32" width="14" height="14" fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2">
    <path d="M2 6 L2 30 30 30 30 6 Z M2 15 L30 15 M7 3 L7 9 M13 3 L13 9 M19 3 L19 9 M25 3 L25 9"></path>
  </svg>
  &nbsp;
  2017-08-04
</time>






    
    &nbsp;
    <svg class="i-tag" viewBox="0 0 32 32" width="14" height="14" fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2">
      <circle cx="24" cy="8" r="2"></circle>
      <path d="M2 18 L18 2 30 2 30 14 14 30 Z"></path>
    </svg>
    &nbsp;
    <a href="/tags/Android/">Android</a>


    </div>
    <hr>
    <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#position-的总结："><span class="toc-text">position 的总结：</span></a></li></ol>
    <div class="picture-container">
      
    </div>
    <p>读书是在别人思想的帮助下建立自己的思想    @尼古拉.鲁巴金  (俄国作家)</p>
<a id="more"></a>
<p>做项目的时候使用到 ViewPager，那么顺便总结一下它的 OnPageChangeListener 监听器。随便撸了个可以判断滑动方向的 ViewPager。欢迎来提Issue。</p>
<p>OnPageChangeListener的有三个回调接口，按照执行顺序分别是：</p>
<figure class="highlight pf"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line">* 响应触摸事件，页面的滑动状态</div><div class="line">* @param <span class="keyword">state</span> SCROLL_STATE_IDLE -&gt; SCROLL_STATE_DRAGGING -&gt; </div><div class="line">* SCROLL_STATE_SETTLING -&gt; SCROLL_STATE_IDLE</div><div class="line">*/</div><div class="line">@Override</div><div class="line">public void <span class="keyword">on</span>PageScrollStateChanged(int <span class="keyword">state</span>) &#123;</div><div class="line">	...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>state 有三个状态值，0、1、2 分别代表初始空闲状态、正在滑动、滑动完成。</p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment">* 当正在滑动的时候，会连续调用。</span></div><div class="line"><span class="comment">* <span class="doctag">@param</span> position  当前你滑动的页面，第一个页面的值为 0</span></div><div class="line"><span class="comment">* <span class="doctag">@param</span> positionOffset 当前页面偏移的百分比</span></div><div class="line"><span class="comment">* <span class="doctag">@param</span> positionOffsetPixels 当前页面的偏移像素</span></div><div class="line"><span class="comment">*/</span></div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onPageScrolled</span><span class="params">(<span class="keyword">int</span> position, <span class="keyword">float</span> positionOffset, <span class="keyword">int</span> positionOffsetPixels)</span> </span>&#123;</div><div class="line">    ...     </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这个回调会在滑动的时候多次调用。</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment">* 页面移动完毕后调用</span></div><div class="line"><span class="comment">* @param position 当前移动完毕后的页面，第一个页面的值为 0</span></div><div class="line"><span class="comment">*/</span></div><div class="line">   @Override</div><div class="line"><span class="keyword">public</span> <span class="keyword">void</span> onPageSelected(<span class="keyword">int</span> <span class="built_in">position</span>) &#123;</div><div class="line">       System.out.<span class="built_in">println</span>(<span class="string">"onPageSelected 当前 position:"</span>+<span class="built_in">position</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<hr>
<p>所以，当发生滑动操作的时候，执行顺序如下：</p>
<p>① 你把手接触屏幕刚进行滑动</p>
<p>② onPageScrollStateChanged#state = 1</p>
<p>③ onPageScrolled (int position, float positionOffset, int positionOffsetPixels)</p>
<p>这个方法会执行多次，以当前页面为基准。下面具体解释一下：</p>
<p>▼向右滑动 ( 向前一个页面 ) </p>
<p>​        ▶ position ： position = curPosition - 1;  //当前位置减 1</p>
<p>​        ▶ positionOffset ：从 1 到 0；//偏移的百分比</p>
<p>​        ▶ positionOffsetPixels：从屏幕像素最大值到 0；//偏移的像素值</p>
<p>▼向左滑动 ( 向后一个页面 ) position = curPosition + 1;</p>
<p>​        ▶position ： position = curPosition + 1;</p>
<p>​        ▶positionOffset ：从 0 到 1；</p>
<p>​        ▶positionOffsetPixels：从屏幕像素最小值到 1；</p>
<p>④ 你松手了</p>
<p>⑤ onPageScrollStateChanged#state = 2</p>
<p>⑥ onPageSelected</p>
<p>⑦ onPageScrolled 参照第 3 点，不过这时候方向已经确定了，只是不断向这个方向的最值改变。</p>
<p>⑧ onPageScrollStateChanged#state = 0</p>
<h3 id="position-的总结："><a href="#position-的总结：" class="headerlink" title="position 的总结："></a>position 的总结：</h3><p>onPageScrolled中的position的变化规律是，假设有3个page，当前正在第二个页面，如果这时你往右（向第一个页面）滑动，那么position的值就是 0 ，position + 1就是1。position + 1 指的是下一个即将滑动到的页面索引。所以这时手不松开向左滑动超过原来第二个页面的位置，这时 position 的值就会变成 1 ，而 position + 1 就变成了 2。</p>
<p>一般情况下，我们在 onPageScrolled 中可以根据手势对 UI 的进行相应变化。</p>
<p>我写了个ViewPager类，可以获取到当前是向左滑动还是向右滑动，只要在回调函数中进行相应的判断和操作即可。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * @创建者 倪军</span></div><div class="line"><span class="comment"> * @创建时间 2017/8/4</span></div><div class="line"><span class="comment"> * @描述 可以判断 ViewPager 滑动的方向。</span></div><div class="line"><span class="comment"> */</span></div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SmartViewPager</span> <span class="keyword">extends</span> <span class="title">ViewPager</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> directionLeft = <span class="keyword">false</span>;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> directionRight = <span class="keyword">false</span>;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> isCompleted = <span class="keyword">true</span>;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> currentPosition = -<span class="number">1</span>;</div><div class="line"></div><div class="line">    onPageChangeListener onPageChangeListener ;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SmartViewPager</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context);</div><div class="line">        init();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SmartViewPager</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context, attrs);</div><div class="line">        init();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</div><div class="line">        addOnPageChangeListener(listener);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    OnPageChangeListener listener = <span class="keyword">new</span> OnPageChangeListener() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onPageScrolled</span><span class="params">(<span class="keyword">int</span> position, <span class="keyword">float</span> positionOffset, <span class="keyword">int</span> positionOffsetPixels)</span> </span>&#123;</div><div class="line">            <span class="comment">//说明是第一次</span></div><div class="line">            <span class="keyword">if</span> (!isCompleted) &#123;</div><div class="line">                <span class="keyword">if</span> (currentPosition == -<span class="number">1</span>) &#123;</div><div class="line">                    <span class="keyword">if</span> (position == <span class="number">0</span> || positionOffset == <span class="number">0.0f</span> || positionOffsetPixels == <span class="number">0</span>) &#123;</div><div class="line">                        directionLeft = <span class="keyword">true</span>;</div><div class="line">                    &#125; <span class="keyword">else</span> &#123;</div><div class="line">                        directionRight = <span class="keyword">true</span>;</div><div class="line">                    &#125;</div><div class="line">                    currentPosition = position;</div><div class="line">                &#125; <span class="keyword">else</span> &#123;</div><div class="line">                    clearState();</div><div class="line">                    <span class="keyword">if</span> (positionOffset &gt; <span class="number">0</span> &amp;&amp; currentPosition == position) &#123;</div><div class="line">                        directionRight = <span class="keyword">true</span>;</div><div class="line">                        <span class="keyword">if</span> (position &lt; currentPosition) &#123;</div><div class="line">                            directionLeft = <span class="keyword">true</span>;</div><div class="line">                        &#125;</div><div class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (positionOffset &gt; <span class="number">0</span>) &#123;</div><div class="line">                        directionLeft = <span class="keyword">true</span>;</div><div class="line">                        <span class="keyword">if</span> (position == currentPosition) &#123;</div><div class="line">                            directionRight = <span class="keyword">true</span>;</div><div class="line">                        &#125;</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="keyword">if</span> (isCompleted) &#123;</div><div class="line">                <span class="comment">//滑动完成了</span></div><div class="line">                <span class="keyword">if</span> (getAdapter() != <span class="keyword">null</span>) &#123;</div><div class="line">                    <span class="comment">//adapter不为null</span></div><div class="line">                    <span class="keyword">if</span> (currentPosition == <span class="number">0</span>) &#123;</div><div class="line">                        <span class="comment">//说明是第一页</span></div><div class="line">                        <span class="keyword">if</span> (currentPosition == position) &#123;</div><div class="line">                        &#125;</div><div class="line">                        <span class="keyword">if</span>(position &gt;currentPosition)&#123;</div><div class="line">                            directionRight = <span class="keyword">true</span>;</div><div class="line">                        &#125;</div><div class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (currentPosition &lt; getAdapter().getCount()-<span class="number">1</span>) &#123;</div><div class="line">                        <span class="comment">//中间部分</span></div><div class="line">                        <span class="keyword">if</span>(position == currentPosition)&#123;</div><div class="line">                        &#125;</div><div class="line">                        <span class="keyword">if</span>(position &lt; currentPosition)&#123;</div><div class="line">                            directionLeft =<span class="keyword">true</span>;</div><div class="line">                        &#125;</div><div class="line">                        <span class="keyword">if</span>(position &gt;currentPosition)&#123;</div><div class="line">                            directionRight = <span class="keyword">true</span>;</div><div class="line">                        &#125;</div><div class="line">                    &#125;<span class="keyword">else</span>&#123;</div><div class="line">                        <span class="comment">//最后一页</span></div><div class="line">                        <span class="keyword">if</span>(position==currentPosition)&#123;</div><div class="line">                        &#125;</div><div class="line">                        <span class="keyword">if</span>(position&lt;currentPosition)&#123;</div><div class="line">                            directionLeft =<span class="keyword">true</span>;</div><div class="line">                        &#125;</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">                currentPosition = position;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onPageSelected</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</div><div class="line"></div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onPageScrollStateChanged</span><span class="params">(<span class="keyword">int</span> state)</span> </span>&#123;</div><div class="line">            System.out.println(<span class="string">"onPageScrollStateChanged current state:"</span> + state);</div><div class="line">            <span class="keyword">if</span> (state == <span class="number">1</span>) &#123;</div><div class="line">                isCompleted = <span class="keyword">false</span>;</div><div class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (state == <span class="number">2</span>) &#123;</div><div class="line">                isCompleted = <span class="keyword">true</span>;</div><div class="line"></div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                onPageChangeListener.onPagechanged(directionLeft,directionRight);</div><div class="line">                Log.d(<span class="string">"SmartViewPager"</span>, <span class="string">"custom onPageChangeListener is called."</span>);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isDirectionLeft</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> directionLeft;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isDirectionRight</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> directionRight;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clearState</span><span class="params">()</span> </span>&#123;</div><div class="line">        directionLeft = <span class="keyword">false</span>;</div><div class="line">        directionRight = <span class="keyword">false</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">onPageChangeListener</span></span>&#123;</div><div class="line">         <span class="function"><span class="keyword">void</span> <span class="title">onPagechanged</span><span class="params">(<span class="keyword">boolean</span> directionLeft,<span class="keyword">boolean</span> directionRight)</span></span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOnPageChangeListener</span><span class="params">(onPageChangeListener onPageChangeListener)</span></span>&#123;</div><div class="line">        <span class="keyword">this</span>.onPageChangeListener = onPageChangeListener;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>附上 GitHub 地址：<br><a href="https://gist.github.com/SmartNJ/00234d5f7ca3bb203788b4644887763f" target="_blank" rel="external">https://gist.github.com/SmartNJ/00234d5f7ca3bb203788b4644887763f</a></p>


  </article>
  </script>
    <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
  </script>
  <div class="busuanzi center">
    页阅读量:&nbsp;<span id="busuanzi_value_page_pv"></span>&nbsp;・&nbsp;
    站访问量:&nbsp;<span id="busuanzi_value_site_pv"></span>&nbsp;・&nbsp;
    站访客数:&nbsp;<span id="busuanzi_value_site_uv"></span>
  </div>




    </div>
  </div>
  <footer class="page-footer"><div class="clearfix">
</div>
<div class="right-foot">
    <div class="firstrow">
        <a href="#top" target="_self">
        <svg class="i-caret-right" viewBox="0 0 32 32" width="24" height="24" fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="3">
            <path d="M10 30 L26 16 10 2 Z"></path>
        </svg>
        </a>
        © XXX 20xx-2017
    </div>
    <div class="secondrow">
        <a href="https://github.com/gaoryrt/hexo-theme-pln">
        Theme Pln
        </a>
    </div>
</div>
<div class="clearfix">
</div>
</footer>
  <script src="//cdn.bootcss.com/jquery/2.2.1/jquery.min.js"></script>
<script src="/js/search.min.js"></script>
<script type="text/javascript">

// disqus scripts


// dropdown scripts
$(".dropdown").click(function(event) {
  var current = $(this);
  event.stopPropagation();
  $(current).children(".dropdown-content")[($(current).children(".dropdown-content").hasClass("open"))?'removeClass':'addClass']("open")
});
$(document).click(function(){
    $(".dropdown-content").removeClass("open");
})

var path = "/search.xml";
searchFunc(path, 'local-search-input', 'local-search-result');

</script>

</body>
</html>
